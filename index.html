<!DOCTYPE html>
<html>
  <head>
    <title>Lunch 2014 Infographic</title>
    <script src="events.json"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.js"></script>
    <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
    <link rel="stylesheet" href="/assets/css/global.css"/>
  </head>
  <body>
    <section class="chart-information">
      <svg class="chart">
      </svg>
    </section>
    <script>
      (function() {
        var width     = 940,
            height    = 900,
            barWidth  = 18,
            barHeight = 15,
            spacer    = 2;

        var tip = d3.tip()
          .attr('class', 'data-tip')
          .offset([-10, 0])
          .html(function(d) {
            var tag = "<p>" + d.name + "</p>";
            if (d.thumb_photo)
              tag += imgTag(d.thumb_photo);

            return tag;

            function imgTag(url) {
              return "<img src="+url+">"
            }
          });

        var chart = d3.select(".chart")
          .attr("width", width)
          .attr("height", height);

        chart.call(tip);

        d3.json("events.json", function(error, json) {
          if (error) return console.warn(error);
          var events = json;

          var y = d3.scale.linear()
            .domain([0, d3.max(events, function(event) {
              return event.rsvps.length;
            })])
            .range([height, 0]);

          var columns = chart.selectAll('g')
              .data(events)
            .enter().append('g')
              .attr('transform', function(d, i) {
                return "translate(" + i * barWidth + ",0)";
              });

          var rsvps = columns.selectAll('rect')
              .data(function(d) { return d.rsvps; })
            .enter().append('rect')
              .attr('data-key', function(d) { return d.key; })
              .attr('width', barWidth - spacer)
              .attr('y', function(d, i) { return y(i); })
              .attr('height', barHeight - spacer)
            .on('mouseover', function(d) {
              tip.show(d);
              d3.selectAll(selector(d)).attr('class', 'highlight');
            })
            .on('mouseout', function(d) {
              tip.hide(d);
              d3.selectAll(selector(d)).attr('class', '');
            });
        });

        function selector(member) {
          return '[data-key=' + member.key + ']';
        }
      })();
    </script>
  </body>
</html>
